function h(t){return{id:t.id,name:t.name,surname:t.surname,raceName:t.raceName}}function l(t){return t.map(r=>h(r))}var S=Math.pow(10,8)*24*60*60*1e3,Y=-S;var f=6e4;var y=3600;var M=y*24,z=M*7,B=M*365.2425,w=B/12,H=w*3,Q=Symbol.for("constructDateFrom");function u(t){return Math.trunc(t*f)}addEventListener("message",({data:t})=>{let r=l(t.drivers),e=t.stints,n=t.driverConfig,i=t.validTeamPaceLaps,s=L(e,r),o=k(s,n),c=A(e,r),a=E(e,r),d=I(e,r),T=new Map(r.map(v=>[v.id,v.raceName])),m=W(i),D=C(i),p=P(m),b=p!==void 0?m.get(p):void 0,g=O(o),x=N(e,r);postMessage({driversTimeOnTrackMap:s,driversTimeOnTrackWarningMap:o,driversStintCountMap:c,driverWithMoreTimeFromLastStint:a,driversTimeFromLastStintMap:d,raceNameById:T,driverPaceById:m,driverBestLapById:D,driverIdBestPace:p,driverBestPaceMillisecond:b,driversTimeOnTrackWarningCount:g,driverLastStintIdByDriverId:x})});function L(t,r){let e=new Map,n=new Date().getTime();for(let i of r)e.set(i.id,0);for(let i of t){let s=i.endedAt?i.endedAt.getTime()-i.startedAt.getTime():n-i.startedAt.getTime();e.set(i.driverId,e.get(i.driverId)+s)}return e}function k(t,r){let e=new Map,n=u(r.minDriverOnTrackMinute),i=u(r.maxDriverOnTrackMinute),s=u(r.warningDriverOnTrackThresholdMinute);return t.forEach((o,c)=>{let a=o<n,d=i-o<=s;e.set(c,a||d)}),e}function O(t){let r=0;return t.forEach(e=>{e&&r++}),r}function A(t,r){let e=new Map;return r.forEach(n=>{e.set(n.id,0)}),t.forEach(n=>{e.has(n.driverId)?e.set(n.driverId,e.get(n.driverId)+1):e.set(n.driverId,1)}),e}function E(t,r){if(r.length===0)return;let e,n=I(t,r),i=t.find(a=>a.endedAt===null)?.driverId,s=new Map(r.map(a=>[a.id,a])),o=-1,c=!1;return n.forEach((a,d)=>{d!==i&&(a===0?(!c||c&&a>o)&&(o=a,e=s.get(d),c=!0):!c&&a>o&&(o=a,e=s.get(d)))}),e}function I(t,r){let e=new Map;return r.forEach(n=>{let i=t.filter(s=>s.driverId===n.id).sort((s,o)=>o.startedAt.getTime()-s.startedAt.getTime()).at(0);i&&i.endedAt?e.set(n.id,new Date().getTime()-i.endedAt.getTime()):e.set(n.id,0)}),e}function W(t){let r=new Map,e=new Map;return t.forEach(n=>{e.has(n.driverId)||e.set(n.driverId,[]),e.get(n.driverId).push(n.lapMilliseconds)}),e.forEach((n,i)=>{if(n.length>0){let s=n.reduce((c,a)=>c+a,0),o=Math.round(s/n.length);r.set(i,o)}}),r}function C(t){let r=new Map;return t.forEach(e=>{let n=r.get(e.driverId);(n===void 0||e.lapMilliseconds<n)&&r.set(e.driverId,e.lapMilliseconds)}),r}function P(t){if(t.size===0)return;let r,e=Number.MAX_SAFE_INTEGER;for(let[n,i]of t)i<e&&(e=i,r=n);return r}function N(t,r){let e=new Map;return r.forEach(n=>{let i=t.filter(s=>s.driverId===n.id&&s.endedAt!==null).sort((s,o)=>o.startedAt.getTime()-s.startedAt.getTime()).at(0);i&&e.set(n.id,i.id)}),e}
