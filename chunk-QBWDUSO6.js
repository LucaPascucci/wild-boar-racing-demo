import{a as Rt}from"./chunk-2QPBAZ2R.js";import{a as Se}from"./chunk-Y44SY3C2.js";import{b as bt,c as Ct,d as vt,e as yt,f as St,g as _t,h as wt,m as Tt,n as Ot,o as ge}from"./chunk-BSEGO7IJ.js";import{a as Lt}from"./chunk-N2W6DWYQ.js";import{b as It,z as qe}from"./chunk-V7PMX2I6.js";import{a as U}from"./chunk-JYL5VZXP.js";import{a as Mt}from"./chunk-PINGEYOB.js";import{b as gt}from"./chunk-AGTGVVTX.js";import{h as He}from"./chunk-QB5SOPTM.js";import{a as ve,l as ye,o as Nt,p as Pt,q as z,r as jt}from"./chunk-IGED4TOA.js";import{M as O,N as g,aa as be,ba as Ce}from"./chunk-Q6UHPJXR.js";import{$b as xt,Ca as c,F as at,Ga as ae,Jb as ut,Ka as L,Kb as ie,M as Ue,Ma as pt,N as ue,Oa as oe,R as y,Sb as ct,Tb as ht,U as ot,Ua as C,X as d,Ya as ce,ab as n,bb as p,ca as it,cb as k,cc as Dt,da as A,ea as E,fb as he,g as rt,gb as x,hb as T,lb as ft,mb as lt,na as ze,nb as mt,oa as nt,ob as m,qb as xe,ra as st,rb as B,sa as _,sb as G,t as V,tb as F,u as re,wb as dt}from"./chunk-7TD4AYMG.js";import{c as de}from"./chunk-2VMXMS7J.js";var sa=typeof global=="object"&&global&&global.Object===Object&&global,_e=sa;var pa=typeof self=="object"&&self&&self.Object===Object&&self,fa=_e||pa||Function("return this")(),S=fa;var la=S.Symbol,H=la;var Wt=Object.prototype,ma=Wt.hasOwnProperty,da=Wt.toString,ne=H?H.toStringTag:void 0;function ua(e){var t=ma.call(e,ne),r=e[ne];try{e[ne]=void 0;var a=!0}catch{}var o=da.call(e);return a&&(t?e[ne]=r:delete e[ne]),o}var At=ua;var ca=Object.prototype,ha=ca.toString;function xa(e){return ha.call(e)}var Et=xa;var ga="[object Null]",ba="[object Undefined]",kt=H?H.toStringTag:void 0;function Ca(e){return e==null?e===void 0?ba:ga:kt&&kt in Object(e)?At(e):Et(e)}var P=Ca;function va(e){return e!=null&&typeof e=="object"}var w=va;var ya=Array.isArray,se=ya;function Sa(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var v=Sa;function _a(e){return e}var we=_a;var wa="[object AsyncFunction]",Ta="[object Function]",Oa="[object GeneratorFunction]",Da="[object Proxy]";function Na(e){if(!v(e))return!1;var t=P(e);return t==Ta||t==Oa||t==wa||t==Da}var q=Na;var La=S["__core-js_shared__"],Te=La;var Bt=function(){var e=/[^.]+$/.exec(Te&&Te.keys&&Te.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Pa(e){return!!Bt&&Bt in e}var Gt=Pa;var ja=Function.prototype,Ma=ja.toString;function Ia(e){if(e!=null){try{return Ma.call(e)}catch{}try{return e+""}catch{}}return""}var Ft=Ia;var Ra=/[\\^$.*+?()[\]{}|]/g,Wa=/^\[object .+?Constructor\]$/,Aa=Function.prototype,Ea=Object.prototype,ka=Aa.toString,Ba=Ea.hasOwnProperty,Ga=RegExp("^"+ka.call(Ba).replace(Ra,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Fa(e){if(!v(e)||Gt(e))return!1;var t=q(e)?Ga:Wa;return t.test(Ft(e))}var Vt=Fa;function Va(e,t){return e?.[t]}var Ut=Va;function Ua(e,t){var r=Ut(e,t);return Vt(r)?r:void 0}var K=Ua;var zt=Object.create,za=function(){function e(){}return function(t){if(!v(t))return{};if(zt)return zt(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Ht=za;function Ha(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var qt=Ha;function qa(e,t){var r=-1,a=e.length;for(t||(t=Array(a));++r<a;)t[r]=e[r];return t}var Kt=qa;var Ka=800,$a=16,Qa=Date.now;function Ja(e){var t=0,r=0;return function(){var a=Qa(),o=$a-(a-r);if(r=a,o>0){if(++t>=Ka)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var $t=Ja;function Xa(e){return function(){return e}}var Qt=Xa;var Za=function(){try{var e=K(Object,"defineProperty");return e({},"",{}),e}catch{}}(),$=Za;var Ya=$?function(e,t){return $(e,"toString",{configurable:!0,enumerable:!1,value:Qt(t),writable:!0})}:we,Jt=Ya;var eo=$t(Jt),Xt=eo;var to=9007199254740991,ro=/^(?:0|[1-9]\d*)$/;function ao(e,t){var r=typeof e;return t=t??to,!!t&&(r=="number"||r!="symbol"&&ro.test(e))&&e>-1&&e%1==0&&e<t}var Oe=ao;function oo(e,t,r){t=="__proto__"&&$?$(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Q=oo;function io(e,t){return e===t||e!==e&&t!==t}var j=io;var no=Object.prototype,so=no.hasOwnProperty;function po(e,t,r){var a=e[t];(!(so.call(e,t)&&j(a,r))||r===void 0&&!(t in e))&&Q(e,t,r)}var Zt=po;function fo(e,t,r,a){var o=!r;r||(r={});for(var i=-1,f=t.length;++i<f;){var s=t[i],l=a?a(r[s],e[s],s,r,e):void 0;l===void 0&&(l=e[s]),o?Q(r,s,l):Zt(r,s,l)}return r}var Yt=fo;var er=Math.max;function lo(e,t,r){return t=er(t===void 0?e.length-1:t,0),function(){for(var a=arguments,o=-1,i=er(a.length-t,0),f=Array(i);++o<i;)f[o]=a[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=a[o];return s[t]=r(f),qt(e,this,s)}}var tr=lo;function mo(e,t){return Xt(tr(e,t,we),e+"")}var rr=mo;var uo=9007199254740991;function co(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=uo}var De=co;function ho(e){return e!=null&&De(e.length)&&!q(e)}var J=ho;function xo(e,t,r){if(!v(r))return!1;var a=typeof t;return(a=="number"?J(r)&&Oe(t,r.length):a=="string"&&t in r)?j(r[t],e):!1}var ar=xo;function go(e){return rr(function(t,r){var a=-1,o=r.length,i=o>1?r[o-1]:void 0,f=o>2?r[2]:void 0;for(i=e.length>3&&typeof i=="function"?(o--,i):void 0,f&&ar(r[0],r[1],f)&&(i=o<3?void 0:i,o=1),t=Object(t);++a<o;){var s=r[a];s&&e(t,s,a,i)}return t})}var or=go;var bo=Object.prototype;function Co(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||bo;return e===r}var Ne=Co;function vo(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}var ir=vo;var yo="[object Arguments]";function So(e){return w(e)&&P(e)==yo}var Ke=So;var nr=Object.prototype,_o=nr.hasOwnProperty,wo=nr.propertyIsEnumerable,To=Ke(function(){return arguments}())?Ke:function(e){return w(e)&&_o.call(e,"callee")&&!wo.call(e,"callee")},pe=To;function Oo(){return!1}var sr=Oo;var lr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,pr=lr&&typeof module=="object"&&module&&!module.nodeType&&module,Do=pr&&pr.exports===lr,fr=Do?S.Buffer:void 0,No=fr?fr.isBuffer:void 0,Lo=No||sr,Le=Lo;var Po="[object Arguments]",jo="[object Array]",Mo="[object Boolean]",Io="[object Date]",Ro="[object Error]",Wo="[object Function]",Ao="[object Map]",Eo="[object Number]",ko="[object Object]",Bo="[object RegExp]",Go="[object Set]",Fo="[object String]",Vo="[object WeakMap]",Uo="[object ArrayBuffer]",zo="[object DataView]",Ho="[object Float32Array]",qo="[object Float64Array]",Ko="[object Int8Array]",$o="[object Int16Array]",Qo="[object Int32Array]",Jo="[object Uint8Array]",Xo="[object Uint8ClampedArray]",Zo="[object Uint16Array]",Yo="[object Uint32Array]",u={};u[Ho]=u[qo]=u[Ko]=u[$o]=u[Qo]=u[Jo]=u[Xo]=u[Zo]=u[Yo]=!0;u[Po]=u[jo]=u[Uo]=u[Mo]=u[zo]=u[Io]=u[Ro]=u[Wo]=u[Ao]=u[Eo]=u[ko]=u[Bo]=u[Go]=u[Fo]=u[Vo]=!1;function ei(e){return w(e)&&De(e.length)&&!!u[P(e)]}var mr=ei;function ti(e){return function(t){return e(t)}}var dr=ti;var ur=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fe=ur&&typeof module=="object"&&module&&!module.nodeType&&module,ri=fe&&fe.exports===ur,$e=ri&&_e.process,ai=function(){try{var e=fe&&fe.require&&fe.require("util").types;return e||$e&&$e.binding&&$e.binding("util")}catch{}}(),Qe=ai;var cr=Qe&&Qe.isTypedArray,oi=cr?dr(cr):mr,Pe=oi;var ii=Object.prototype,ni=ii.hasOwnProperty;function si(e,t){var r=se(e),a=!r&&pe(e),o=!r&&!a&&Le(e),i=!r&&!a&&!o&&Pe(e),f=r||a||o||i,s=f?ir(e.length,String):[],l=s.length;for(var h in e)(t||ni.call(e,h))&&!(f&&(h=="length"||o&&(h=="offset"||h=="parent")||i&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||Oe(h,l)))&&s.push(h);return s}var hr=si;function pi(e,t){return function(r){return e(t(r))}}var xr=pi;function fi(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var gr=fi;var li=Object.prototype,mi=li.hasOwnProperty;function di(e){if(!v(e))return gr(e);var t=Ne(e),r=[];for(var a in e)a=="constructor"&&(t||!mi.call(e,a))||r.push(a);return r}var br=di;function ui(e){return J(e)?hr(e,!0):br(e)}var je=ui;var ci=K(Object,"create"),D=ci;function hi(){this.__data__=D?D(null):{},this.size=0}var Cr=hi;function xi(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var vr=xi;var gi="__lodash_hash_undefined__",bi=Object.prototype,Ci=bi.hasOwnProperty;function vi(e){var t=this.__data__;if(D){var r=t[e];return r===gi?void 0:r}return Ci.call(t,e)?t[e]:void 0}var yr=vi;var yi=Object.prototype,Si=yi.hasOwnProperty;function _i(e){var t=this.__data__;return D?t[e]!==void 0:Si.call(t,e)}var Sr=_i;var wi="__lodash_hash_undefined__";function Ti(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=D&&t===void 0?wi:t,this}var _r=Ti;function X(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}X.prototype.clear=Cr;X.prototype.delete=vr;X.prototype.get=yr;X.prototype.has=Sr;X.prototype.set=_r;var Je=X;function Oi(){this.__data__=[],this.size=0}var wr=Oi;function Di(e,t){for(var r=e.length;r--;)if(j(e[r][0],t))return r;return-1}var M=Di;var Ni=Array.prototype,Li=Ni.splice;function Pi(e){var t=this.__data__,r=M(t,e);if(r<0)return!1;var a=t.length-1;return r==a?t.pop():Li.call(t,r,1),--this.size,!0}var Tr=Pi;function ji(e){var t=this.__data__,r=M(t,e);return r<0?void 0:t[r][1]}var Or=ji;function Mi(e){return M(this.__data__,e)>-1}var Dr=Mi;function Ii(e,t){var r=this.__data__,a=M(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}var Nr=Ii;function Z(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}Z.prototype.clear=wr;Z.prototype.delete=Tr;Z.prototype.get=Or;Z.prototype.has=Dr;Z.prototype.set=Nr;var I=Z;var Ri=K(S,"Map"),Me=Ri;function Wi(){this.size=0,this.__data__={hash:new Je,map:new(Me||I),string:new Je}}var Lr=Wi;function Ai(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Pr=Ai;function Ei(e,t){var r=e.__data__;return Pr(t)?r[typeof t=="string"?"string":"hash"]:r.map}var R=Ei;function ki(e){var t=R(this,e).delete(e);return this.size-=t?1:0,t}var jr=ki;function Bi(e){return R(this,e).get(e)}var Mr=Bi;function Gi(e){return R(this,e).has(e)}var Ir=Gi;function Fi(e,t){var r=R(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}var Rr=Fi;function Y(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}Y.prototype.clear=Lr;Y.prototype.delete=jr;Y.prototype.get=Mr;Y.prototype.has=Ir;Y.prototype.set=Rr;var Wr=Y;var Vi=xr(Object.getPrototypeOf,Object),Ie=Vi;var Ui="[object Object]",zi=Function.prototype,Hi=Object.prototype,Ar=zi.toString,qi=Hi.hasOwnProperty,Ki=Ar.call(Object);function $i(e){if(!w(e)||P(e)!=Ui)return!1;var t=Ie(e);if(t===null)return!0;var r=qi.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Ar.call(r)==Ki}var Er=$i;function Qi(){this.__data__=new I,this.size=0}var kr=Qi;function Ji(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Br=Ji;function Xi(e){return this.__data__.get(e)}var Gr=Xi;function Zi(e){return this.__data__.has(e)}var Fr=Zi;var Yi=200;function en(e,t){var r=this.__data__;if(r instanceof I){var a=r.__data__;if(!Me||a.length<Yi-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new Wr(a)}return r.set(e,t),this.size=r.size,this}var Vr=en;function ee(e){var t=this.__data__=new I(e);this.size=t.size}ee.prototype.clear=kr;ee.prototype.delete=Br;ee.prototype.get=Gr;ee.prototype.has=Fr;ee.prototype.set=Vr;var Ur=ee;var Kr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zr=Kr&&typeof module=="object"&&module&&!module.nodeType&&module,tn=zr&&zr.exports===Kr,Hr=tn?S.Buffer:void 0,qr=Hr?Hr.allocUnsafe:void 0;function rn(e,t){if(t)return e.slice();var r=e.length,a=qr?qr(r):new e.constructor(r);return e.copy(a),a}var $r=rn;var an=S.Uint8Array,Xe=an;function on(e){var t=new e.constructor(e.byteLength);return new Xe(t).set(new Xe(e)),t}var Qr=on;function nn(e,t){var r=t?Qr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Jr=nn;function sn(e){return typeof e.constructor=="function"&&!Ne(e)?Ht(Ie(e)):{}}var Xr=sn;function pn(e){return function(t,r,a){for(var o=-1,i=Object(t),f=a(t),s=f.length;s--;){var l=f[e?s:++o];if(r(i[l],l,i)===!1)break}return t}}var Zr=pn;var fn=Zr(),Yr=fn;function ln(e,t,r){(r!==void 0&&!j(e[t],r)||r===void 0&&!(t in e))&&Q(e,t,r)}var le=ln;function mn(e){return w(e)&&J(e)}var ea=mn;function dn(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var me=dn;function un(e){return Yt(e,je(e))}var ta=un;function cn(e,t,r,a,o,i,f){var s=me(e,r),l=me(t,r),h=f.get(l);if(h){le(e,r,h);return}var b=i?i(s,l,r+"",e,t,f):void 0,W=b===void 0;if(W){var Fe=se(l),Ve=!Fe&&Le(l),tt=!Fe&&!Ve&&Pe(l);b=l,Fe||Ve||tt?se(s)?b=s:ea(s)?b=Kt(s):Ve?(W=!1,b=$r(l,!0)):tt?(W=!1,b=Jr(l,!0)):b=[]:Er(l)||pe(l)?(b=s,pe(s)?b=ta(s):(!v(s)||q(s))&&(b=Xr(l))):W=!1}W&&(f.set(l,b),o(b,l,a,i,f),f.delete(l)),le(e,r,b)}var ra=cn;function aa(e,t,r,a,o){e!==t&&Yr(t,function(i,f){if(o||(o=new Ur),v(i))ra(e,t,f,r,aa,a,o);else{var s=a?a(me(e,f),i,f+"",e,t,o):void 0;s===void 0&&(s=i),le(e,f,s)}},je)}var oa=aa;var hn=or(function(e,t,r){oa(e,t,r)}),Ze=hn;var xn=new ot("Configuration for ngCharts");var gn=(()=>{class e{constructor(){this.colorschemesOptions=new rt(void 0)}setColorschemesOptions(r){this.pColorschemesOptions=r,this.colorschemesOptions.next(r)}getColorschemesOptions(){return this.pColorschemesOptions}static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ye=(()=>{class e{constructor(r,a,o,i){this.zone=a,this.themeService=o,this.type="bar",this.plugins=[],this.chartClick=new ze,this.chartHover=new ze,this.subs=[],this.themeOverrides={},i?.registerables&&qe.register(...i.registerables),i?.defaults&&It.set(i.defaults),this.ctx=r.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(at()).subscribe(f=>this.themeChanged(f)))}ngOnChanges(r){let a=["type"],o=Object.getOwnPropertyNames(r);if(o.some(i=>a.includes(i))||o.every(i=>r[i].isFirstChange()))this.render();else{let i=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,i.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,i.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,i.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(r=>r.unsubscribe())}render(){return this.chart&&this.chart.destroy(),this.zone.runOutsideAngular(()=>this.chart=new qe(this.ctx,this.getChartConfiguration()))}update(r){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(r))}hideDataset(r,a){this.chart&&(this.chart.getDatasetMeta(r).hidden=a,this.update())}isDatasetHidden(r){return this.chart?.getDatasetMeta(r)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(r){this.themeOverrides=r,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return Ze({onHover:(r,a)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:r,active:a}))},onClick:(r,a)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:r,active:a}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions(),plugins:this.plugins}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}static{this.\u0275fac=function(a){return new(a||e)(ae(st),ae(nt),ae(gn),ae(xn,8))}}static{this.\u0275dir=pt({type:e,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[it]})}}return e})();var te=class e extends ve{collectionPath="/gap-chart-configs";collectionRef=Ce(this.firestore,this.collectionPath);gapChartConfig=_(void 0);constructor(){super(),this.getAll().pipe(O()).subscribe(t=>{t.length>0&&this.gapChartConfig.set(t.at(0))})}updateLapWindow(t){let r=this.gapChartConfig();r&&(r.lapWindow=t,this.updateDataWithMessage(r.id,r,"lap window"))}updateGapWindow(t){let r=this.gapChartConfig();r&&(r.gapWindowMilliseconds=t,this.updateDataWithMessage(r.id,r,"gap window"))}getAll(){return be(this.collectionRef).pipe(ue(this.destroyed),V(t=>t.map(r=>r).filter(r=>!r.deleted)))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var Re=class e extends ve{collectionPath="/chart-color-updates";collectionRef=Ce(this.firestore,this.collectionPath);raceService=d(ye);chartColorUpdate=_(void 0);constructor(){super(),re({chartColorUpdate:this.getChartColorUpdate()}).pipe(O()).subscribe(({chartColorUpdate:t})=>{if(t){let r=this.chartColorUpdate();(!r||r.updatedAt<t.updatedAt)&&this.chartColorUpdate.set(t)}})}getChartColorUpdate(){return re({chartColorUpdates:be(this.collectionRef),activeRace:g(this.raceService.activeRace)}).pipe(ue(this.destroyed),V(({chartColorUpdates:t,activeRace:r})=>{let a=t;if(r&&a.length>0)return a.filter(o=>!o.deleted&&o.raceId===r.id).at(0)}))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};function bn(e){return{id:e.id,raceId:e.raceId,raceNumber:e.raceNumber,color:e.color}}function ia(e){return e.map(t=>bn(t))}var We=class e{path="/chart-color-management";httpClient=d(xt);chartColorUpdateService=d(Re);raceService=d(ye);chartColors=_([]);chartColorsByRaceNumber=_(new Map);constructor(){g(this.raceService.activeRace).pipe(Ue(t=>t?this.getChartColors(t.id,[]):[]),O()).subscribe(t=>{this.chartColors.set(this.merge(this.chartColors(),t)),this.chartColorsByRaceNumber.set(new Map(this.chartColors().map(r=>[r.raceNumber,r.color])))}),g(this.chartColorUpdateService.chartColorUpdate).pipe(Ue(t=>t?this.getChartColors(t.raceId,t.updatedIds):[]),O()).subscribe(t=>{this.chartColors.set(this.merge(this.chartColors(),t)),this.chartColorsByRaceNumber.set(new Map(this.chartColors().map(r=>[r.raceNumber,r.color])))})}merge(t,r){let a=new Map(t.map(o=>[o.id,o]));return r.forEach(o=>{a.set(o.id,o)}),Array.from(a.values()).sort((o,i)=>o.id-i.id)}getChartColors(t,r){return this.httpClient.post(`${Dt.baseUrl}${this.path}/chart-colors`,{raceId:t,ids:r}).pipe(V(a=>ia(a)))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ae=class e{lapSimulatorService=d(Rt);lapSimulatorConfigService=d(Se);gapChartConfigService=d(te);gapChartColorDataService=d(We);teamService=d(z);worker;chartData=_(void 0);constructor(){typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-XLAD2B7V.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:t})=>{this.chartData.set(t.chartData)}),re({normalizedCumulatedTimeLaps:g(this.lapSimulatorService.normalizedCumulatedTimeLaps),shadowLaps:g(this.lapSimulatorService.shadowLaps),futureLaps:g(this.lapSimulatorService.futureLaps),futureLapsWithPitNow:g(this.lapSimulatorService.futureLapsWithPitNow),teamNamesByRaceNumber:g(this.teamService.teamNameByRaceNumber),gapChartVisibleByRaceNumber:g(this.teamService.gapChartVisibleByRaceNumber),shadowChartVisibleByRaceNumber:g(this.teamService.shadowChartVisibleByRaceNumber),pitNowChartVisibleByRaceNumber:g(this.teamService.pitNowChartVisibleByRaceNumber),lapSimulatorConfig:g(this.lapSimulatorConfigService.lapSimulatorConfig),gapChartConfig:g(this.gapChartConfigService.gapChartConfig),gapChartColorsByRaceNumber:g(this.gapChartColorDataService.chartColorsByRaceNumber)}).pipe(O()).subscribe(({normalizedCumulatedTimeLaps:t,shadowLaps:r,futureLaps:a,futureLapsWithPitNow:o,teamNamesByRaceNumber:i,gapChartVisibleByRaceNumber:f,shadowChartVisibleByRaceNumber:s,pitNowChartVisibleByRaceNumber:l,lapSimulatorConfig:h,gapChartConfig:b,gapChartColorsByRaceNumber:W})=>{this.worker&&b&&h&&t.size>0&&this.worker.postMessage({normalizedCumulatedTimeLaps:t,teamNamesByRaceNumber:i,gapChartVisibleByRaceNumber:f,shadowChartVisibleByRaceNumber:s,pitNowChartVisibleByRaceNumber:l,shadowLaps:r,futureLaps:a,futureLapsWithPitNow:o,colorByRaceNumber:W,gapChartConfig:b,lapSimulatorConfig:h})})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ee=class e{chartsLoaded=!1;loadCharts(){return de(this,null,function*(){if(this.chartsLoaded)return;let{Chart:t,registerables:r}=yield import("./chunk-S5XBQ6GG.js");t.register(...r),this.chartsLoaded=!0})}isLoaded(){return this.chartsLoaded}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};function Cn(e,t){if(e&1){let r=he();n(0,"canvas",4),x("chartHover",function(o){A(r);let i=T();return E(i.chartHovered(o))})("chartClick",function(o){A(r);let i=T();return E(i.chartClicked(o))}),p()}if(e&2){let r=T();C("data",r.chartData)("options",r.chartOptions)("type",r.chartType)("legend",!r.hideLegend)}}function vn(e,t){e&1&&(n(0,"div",3)(1,"div",5),m(2,"Loading chart..."),p()())}var ke=class e{gapChartService=d(Ae);chartLoaderService=d(Ee);teamService=d(z);lapService=d(jt);lapDataService=d(Nt);chart;chartsReady=_(!1);constructor(){ie(()=>{let t=this.gapChartService.chartData();t&&this.chartsReady()&&(this.chartData=t)}),this.onResize(),window.addEventListener("resize",this.onResize.bind(this))}ngOnInit(){return de(this,null,function*(){yield this.chartLoaderService.loadCharts(),this.chartsReady.set(!0)})}onResize(){this.hideLegend=window.innerWidth<=700}hideLegend=!1;chartData={datasets:[]};chartOptions={responsive:!0,maintainAspectRatio:!1,scales:{y:{position:"left"}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:t=>this.createTooltipData(t)}}},animation:!1,animations:{colors:!1,x:!1},transitions:{active:{animation:{duration:0}}}};chartType="scatter";chartClicked({event:t,active:r}){}chartHovered({event:t,active:r}){}createTooltipData(t){let r=[],a=this.extractDataType(t.dataset.label||"");a!=="CURRENT"&&r.push(`${a}`);let o=this.extractRaceNumber(t.dataset.label||""),i=this.getTeamName(o);o&&(i?r.push(`${i} (#${o})`):r.push(`#${o}`));let s=t.dataset.data[t.dataIndex].x;s&&r.push(`Lap: ${s}`);let l=this.getLapTime(o,s);l&&a==="CURRENT"&&r.push(`Lap Time: ${l}`);let h=this.getCurrentPace(o);return h&&a==="CURRENT"&&r.push(`Current AVG: ${h}`),r}extractDataType(t){let r=t.split(" - ");if(r.length>=2&&!isNaN(Number(r[0])))return"CURRENT";if(r.length>=3){let a=r[0].trim();if(["FUTURE","SHADOW","PIT NOW"].includes(a))return a}}extractRaceNumber(t){let r=t.split(" - ");if(r.length>=2&&!isNaN(Number(r[0])))return Number(r[0]);if(r.length>=3&&!isNaN(Number(r[1])))return Number(r[1]);let a=t.match(/\d+/);if(a)return Number(a[0])}getTeamName(t){if(t!==void 0)return this.teamService.teamNameByRaceNumber().get(t)}getLapTime(t,r){if(t===void 0||r===void 0)return;let a=this.lapDataService.laps().find(o=>o.raceNumber===t&&o.lapNumber===r);if(a)return He(a.lapMilliseconds)}getCurrentPace(t){if(t===void 0)return;let r=this.lapService.pacesByRaceNumber().get(t);if(r)return He(r)}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=L({type:e,selectors:[["app-gap-chart"]],viewQuery:function(r,a){if(r&1&&ft(Ye,5),r&2){let o;lt(o=mt())&&(a.chart=o.first)}},decls:4,vars:3,consts:[["title","\u{1F4C8} Gap chart",3,"initiallyOpen","canOpen"],["slot","body-content",1,"flex","flex-col","min-h-[700px]"],["baseChart","",3,"data","options","type","legend"],[1,"flex","items-center","justify-center","h-64"],["baseChart","",3,"chartHover","chartClick","data","options","type","legend"],[1,"text-neutral-900","dark:text-neutral-100"]],template:function(r,a){r&1&&(n(0,"app-card",0)(1,"div",1),oe(2,Cn,1,4,"canvas",2)(3,vn,3,0,"div",3),p()()),r&2&&(C("initiallyOpen",!0)("canOpen",!1),c(2),ce(a.chartsReady()?2:3))},dependencies:[Ye,ge,U],encapsulation:2})};var yn=(e,t)=>({"bg-green-100 dark:bg-green-900 font-semibold":e,"hover:bg-neutral-100 dark:hover:bg-neutral-700":t});function Sn(e,t){e&1&&m(0," RN ")}function _n(e,t){e&1&&m(0," Race Number ")}function wn(e,t){if(e&1){let r=he();n(0,"tr",12)(1,"td",13),m(2),p(),n(3,"td",14),m(4),p(),n(5,"td",15),m(6),p(),n(7,"td",16)(8,"input",17),x("change",function(){let o=A(r).$implicit,i=T();return E(i.updateGraphTeamByRaceNumber(o))}),p()(),n(9,"td",16)(10,"input",17),x("change",function(){let o=A(r).$implicit,i=T();return E(i.updatePitNowTeamByRaceNumber(o))}),p()(),n(11,"td",16)(12,"input",17),x("change",function(){let o=A(r).$implicit,i=T();return E(i.updateShadowTeamByRaceNumber(o))}),p()()()}if(e&2){let r=t.$implicit,a=T();C("ngClass",dt(10,yn,r.id===a.activeTeamId(),r.id!==a.activeTeamId())),c(2),xe(" ",r.id," "),c(2),xe(" ",r.name," "),c(2),xe(" ",r.raceNumber," "),c(2),C("id","GapTeam_"+r.id)("checked",r.gapChartVisible),c(2),C("id","pitNowTeam_"+r.id)("checked",r.pitNowChartVisible),c(2),C("id","shadowTeam_"+r.id)("checked",r.shadowChartVisible)}}var Be=class e{teamDataService=d(Pt);teamService=d(z);teams=this.teamDataService.teams;activeTeamId=ut(()=>this.teamService.activeTeam()?.id);smallScreen=!1;constructor(){this.onResize(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){this.smallScreen=700>window.innerWidth}updateGraphTeamByRaceNumber(t){this.teamDataService.updateGapChartVisibility(t.id,!t.gapChartVisible)}updatePitNowTeamByRaceNumber(t){this.teamDataService.updatePitNowChartVisibility(t.id,!t.pitNowChartVisible)}updateShadowTeamByRaceNumber(t){this.teamDataService.updateShadowChartVisibility(t.id,!t.shadowChartVisible)}resetVisibility(){this.teamDataService.resetChartVisibility()}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=L({type:e,selectors:[["app-team"]],decls:25,vars:4,consts:[["title","\u{1F9D1}\u200D\u{1F9D1}\u200D\u{1F9D2}\u200D\u{1F9D2} Team",3,"initiallyOpen","canOpen"],["slot","header-right-content"],[1,"bg-red-500","hover:bg-red-700","disabled:bg-red-200","text-neutral-100","font-bold","py-2","px-4","rounded-sm","hover:cursor-pointer",3,"click"],["slot","body-content",1,"max-h-[450px]","flex","flex-col","overflow-clip"],[1,"w-full","bg-neutral-50","dark:bg-neutral-800","table-fixed"],[1,"sticky","top-0"],[1,"py-2","px-3","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400"],["colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400"],[1,"flex-1","overflow-y-auto"],[1,"w-full","table-fixed"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"py-2","px-3","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100","font-mono"],["colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100","font-mono"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100"],["type","checkbox",3,"change","id","checked"]],template:function(r,a){r&1&&(n(0,"app-card",0)(1,"div",1)(2,"button",2),x("click",function(){return a.resetVisibility()}),m(3," Reset "),p()(),n(4,"div",3)(5,"table",4)(6,"thead",5)(7,"tr")(8,"th",6),m(9," ID "),p(),n(10,"th",7),m(11," Name "),p(),n(12,"th",8),oe(13,Sn,1,0)(14,_n,1,0),p(),n(15,"th",8),m(16," Gap "),p(),n(17,"th",8),m(18," Pit now "),p(),n(19,"th",8),m(20," Shadow "),p()()()(),n(21,"div",9)(22,"table",10)(23,"tbody"),oe(24,wn,13,13,"tr",11),p()()()()()),r&2&&(C("initiallyOpen",!0)("canOpen",!0),c(13),ce(a.smallScreen?13:14),c(11),C("ngForOf",a.teams()))},dependencies:[ht,U,ct],encapsulation:2})};var Ge=class e{lapSimulatorConfigService=d(Se);gapChartConfigService=d(te);referenceRaceNumber=0;lapWindow=0;simulatedLaps=0;gapWindow=0;nextPitMilliseconds=0;timeLostThroughPitMilliseconds=0;tooltipData={footer:"",paragraphs:["Actually not used for race logic"],title:""};tooltipPosition="right";tooltipTLTPData={footer:"",paragraphs:["TTime Lost Through Pit"],title:""};tooltipTLTPPosition="above";constructor(){ie(()=>{let t=this.lapSimulatorConfigService.lapSimulatorConfig();t&&(this.simulatedLaps=t.simulatedLaps,this.referenceRaceNumber=t.referenceRaceNumber,this.nextPitMilliseconds=t.nextPitMilliseconds,this.timeLostThroughPitMilliseconds=t.timeLostThroughPitMilliseconds)}),ie(()=>{let t=this.gapChartConfigService.gapChartConfig();t&&(this.lapWindow=t.lapWindow,this.gapWindow=t.gapWindowMilliseconds)})}onSubmitReferenceRaceNumber(){this.lapSimulatorConfigService.updateReferenceRaceNumber(this.referenceRaceNumber)}onSubmitNextPitMilliseconds(){this.lapSimulatorConfigService.updateNextPitMilliseconds(this.nextPitMilliseconds)}onSubmitGapWindow(){this.gapChartConfigService.updateGapWindow(this.gapWindow)}onSubmitLapWindow(){this.gapChartConfigService.updateLapWindow(this.lapWindow)}increaseLapWindow(){this.gapChartConfigService.updateLapWindow(this.lapWindow+1)}decreaseLapWindow(){this.gapChartConfigService.updateLapWindow(this.lapWindow-1)}onSubmitSimulatedLaps(){this.lapSimulatorConfigService.updateSimulatedLaps(this.simulatedLaps)}increaseSimulatedLaps(){this.lapSimulatorConfigService.updateSimulatedLaps(this.simulatedLaps+1)}decreaseSimulatedLaps(){this.lapSimulatorConfigService.updateSimulatedLaps(this.simulatedLaps-1)}onSubmitTimeLostThroughPitMilliseconds(){this.lapSimulatorConfigService.updateTimeLostThroughPitMilliseconds(this.timeLostThroughPitMilliseconds)}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=L({type:e,selectors:[["app-gap-chart-config"]],decls:47,vars:13,consts:[["title","\u{1F4C8}\u2699\uFE0F Gap chart config",3,"initiallyOpen"],["slot","body-content",1,"flex","flex-col","gap-2"],[1,"flex","justify-between","items-end","gap-2"],[1,"text-neutral-500","dark:text-neutral-400","text-left"],[1,"text-left",3,"ngSubmit"],["type","number","id","referenceRaceNumber","name","referenceRaceNumber","required","","min","0",1,"border","rounded-lg","px-2","py-1","max-w-16","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"],[1,"text-neutral-500","dark:text-neutral-400","text-right"],[1,"flex","justify-end","flex-row","gap-1"],[1,"bg-neutral-200","hover:bg-neutral-400","active:bg-neutral-500","text-black","px-4","rounded-sm","hover:cursor-pointer",3,"click"],[3,"ngSubmit"],["type","number","id","simulatedLaps","name","simulatedLaps","required","","min","1",1,"border","rounded-lg","px-2","py-1","max-w-18","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"],[1,"flex","justify-start","flex-row","gap-1"],["type","number","id","lapWindow","name","lapWindow","required","","min","1",1,"border","rounded-lg","px-2","py-1","max-w-20","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"],["tooltip","",3,"tooltipEnabled","tooltipData","tooltipPosition"],[1,"text-right",3,"ngSubmit"],["type","number","id","gapWindow","name","gapWindow","required","","min","1",1,"border","rounded-lg","px-2","py-1","max-w-30","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"],["type","number","id","nextPitMilliseconds","name","nextPitMilliseconds","required","","min","1",1,"border","rounded-lg","px-2","py-1","max-w-30","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"],["type","number","id","timeLostThroughPitMilliseconds","name","timeLostThroughPitMilliseconds","required","",1,"border","rounded-lg","px-2","py-1","max-w-24","text-right","text-neutral-900","dark:text-neutral-100",3,"ngModelChange","ngModel"]],template:function(r,a){r&1&&(n(0,"app-card",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),m(5,"Reference race number"),p(),n(6,"form",4),x("ngSubmit",function(){return a.onSubmitReferenceRaceNumber()}),n(7,"input",5),F("ngModelChange",function(i){return G(a.referenceRaceNumber,i)||(a.referenceRaceNumber=i),i}),p()()(),n(8,"div")(9,"div",6),m(10,"Lap simulated"),p(),n(11,"div",7)(12,"button",8),x("click",function(){return a.increaseSimulatedLaps()}),m(13," + "),p(),n(14,"form",9),x("ngSubmit",function(){return a.onSubmitSimulatedLaps()}),n(15,"input",10),F("ngModelChange",function(i){return G(a.simulatedLaps,i)||(a.simulatedLaps=i),i}),p()(),n(16,"button",8),x("click",function(){return a.decreaseSimulatedLaps()}),m(17," - "),p()()()(),k(18,"hr"),n(19,"div",2)(20,"div")(21,"div",3),m(22,"Lap window"),p(),n(23,"div",11)(24,"button",8),x("click",function(){return a.increaseLapWindow()}),m(25," + "),p(),n(26,"form",9),x("ngSubmit",function(){return a.onSubmitLapWindow()}),n(27,"input",12),F("ngModelChange",function(i){return G(a.lapWindow,i)||(a.lapWindow=i),i}),p()(),n(28,"button",8),x("click",function(){return a.decreaseLapWindow()}),m(29," - "),p()()(),n(30,"div",13)(31,"div",6),m(32,"Gap window (mills)"),p(),n(33,"form",14),x("ngSubmit",function(){return a.onSubmitGapWindow()}),n(34,"input",15),F("ngModelChange",function(i){return G(a.gapWindow,i)||(a.gapWindow=i),i}),p()()()(),k(35,"hr"),n(36,"div",2)(37,"div")(38,"div",3),m(39,"Next pit (mills)"),p(),n(40,"form",9),x("ngSubmit",function(){return a.onSubmitNextPitMilliseconds()}),n(41,"input",16),F("ngModelChange",function(i){return G(a.nextPitMilliseconds,i)||(a.nextPitMilliseconds=i),i}),p()()(),n(42,"div",13)(43,"div",6),m(44,"TLTP (mills)"),p(),n(45,"form",14),x("ngSubmit",function(){return a.onSubmitTimeLostThroughPitMilliseconds()}),n(46,"input",17),F("ngModelChange",function(i){return G(a.timeLostThroughPitMilliseconds,i)||(a.timeLostThroughPitMilliseconds=i),i}),p()()()()()()),r&2&&(C("initiallyOpen",!0),c(7),B("ngModel",a.referenceRaceNumber),c(8),B("ngModel",a.simulatedLaps),c(12),B("ngModel",a.lapWindow),c(3),C("tooltipEnabled",!0)("tooltipData",a.tooltipData)("tooltipPosition",a.tooltipPosition),c(4),B("ngModel",a.gapWindow),c(7),B("ngModel",a.nextPitMilliseconds),c(),C("tooltipEnabled",!0)("tooltipData",a.tooltipTLTPData)("tooltipPosition",a.tooltipTLTPPosition),c(4),B("ngModel",a.timeLostThroughPitMilliseconds))},dependencies:[ge,_t,bt,wt,Ct,vt,Ot,Tt,St,yt,U,Lt],encapsulation:2})};var na=class e{titleService=d(gt);constructor(){this.titleService.setTitle("WBR - Chart")}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=L({type:e,selectors:[["app-chart"]],decls:10,vars:0,consts:[[1,"p-4","flex","flex-row","justify-between"],[1,"text-xl","md:text-3xl","dark:text-neutral-100","text-neutral-900","font-semibold"],[1,"mx-2","grid","grid-cols-1","lg:grid-cols-7","gap-2"],[1,"flex","flex-col","md:h-fit","lg:col-span-2","gap-2"],[1,"flex","flex-col","md:h-fit","lg:col-span-5","gap-2"]],template:function(r,a){r&1&&(n(0,"div",0)(1,"div",1),m(2,"\u{1F4C8} WBR - Chart \u{1F417}"),p(),k(3,"app-navigator"),p(),n(4,"div",2)(5,"div",3),k(6,"app-gap-chart-config")(7,"app-team"),p(),n(8,"div",4),k(9,"app-gap-chart"),p()())},dependencies:[ke,Mt,Be,Ge],encapsulation:2})};export{na as ChartComponent};
