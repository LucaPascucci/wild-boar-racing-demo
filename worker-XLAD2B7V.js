addEventListener("message",({data:r})=>{let n=r.gapChartConfig,l=r.lapSimulatorConfig,c=r.normalizedCumulatedTimeLaps,p=r.shadowLaps,m=r.futureLaps,i=r.futureLapsWithPitNow,a=r.teamNamesByRaceNumber,u=r.colorByRaceNumber,t=r.gapChartVisibleByRaceNumber,e=r.shadowChartVisibleByRaceNumber,o=r.pitNowChartVisibleByRaceNumber,s=l.referenceRaceNumber,f=n.lapWindow,d=L(c,p,f,s),g=b(d,a,m,i,u,t,e,o);postMessage({chartData:g})});function L(r,n,l,c){let p=new Map,m=[],i=0;if(c&&r.has(c)){let a=r.get(c);i=a!==void 0?a.length-l:0}else{let a=Number.MAX_VALUE;r.forEach(u=>{a=Math.min(a,u.length)}),i=a-l}return i<=0?{cumulatedTimeLapsWindow:r,startLapNumber:0,shadowTimeLapsWindow:n}:(r.forEach((a,u)=>{if(a.length>i){let t=a.slice(i);p.set(u,t)}}),n.forEach(a=>{if(a.startLapNumber>=i)m.push({startLapNumber:a.startLapNumber,cumulatedTimeLaps:p});else{let u=i,t=new Map;a.cumulatedTimeLaps.forEach((e,o)=>{let s=e.slice(i-a.startLapNumber);t.set(o,s)}),m.push({startLapNumber:u,cumulatedTimeLaps:t})}}),{cumulatedTimeLapsWindow:p,startLapNumber:i,shadowTimeLapsWindow:m})}function b(r,n,l,c,p,m,i,a){let u=[];return r.cumulatedTimeLapsWindow.forEach((t,e)=>{if(!m.get(e))return;let o=p.get(e),s=n.has(e)?" - "+n.get(e):"",f=e+s,d={data:h(t,r.startLapNumber),label:f,backgroundColor:o,borderColor:o,pointBackgroundColor:o,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:o,showLine:!0,parsing:!1,normalized:!0};u.push(d)}),r.shadowTimeLapsWindow.forEach(t=>{t.cumulatedTimeLaps.forEach((e,o)=>{if(!i.get(o))return;let s=p.get(o),f=n.has(o)?" - "+n.get(o):"",d="SHADOW - "+o+f,g={data:h(e,t.startLapNumber),label:d,backgroundColor:"gray",borderColor:"gray",pointBackgroundColor:s,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"gray",showLine:!0,parsing:!1,normalized:!0};u.push(g)})}),l.forEach(t=>{t.cumulatedTimeLaps.forEach((e,o)=>{if(!m.get(o))return;let s=p.get(o),f=n.has(o)?" - "+n.get(o):"",d="FUTURE - "+o+f,g={data:h(e,t.startLapNumber),label:d,backgroundColor:"gray",borderColor:s,pointBackgroundColor:s,pointBorderColor:"#fff",pointHoverBackgroundColor:s,pointHoverBorderColor:"gray",borderDash:[5,5],showLine:!0,parsing:!1,normalized:!0};u.push(g)})}),c.forEach(t=>{t.cumulatedTimeLaps.forEach((e,o)=>{if(!a.get(o))return;let s=p.get(o),f=n.has(o)?" - "+n.get(o):"",d="PIT NOW - "+o+f,g={data:h(e,t.startLapNumber),label:d,backgroundColor:"gray",borderColor:s,pointBackgroundColor:s,pointBorderColor:"#fff",pointHoverBackgroundColor:s,pointHoverBorderColor:"gray",borderDash:[5,5],showLine:!0,parsing:!1,normalized:!0};u.push(g)})}),{datasets:u}}function h(r,n){let l=[];return r.forEach((c,p)=>{l.push({x:p+n,y:c})}),l}
