var g=Math.pow(10,8)*24*60*60*1e3,O=-g;var S=1e3;var h=3600;var x=h*24,Y=x*7,y=x*365.2425,P=y/12,v=P*3,l=Symbol.for("constructDateFrom");function p(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&l in t?t[l](e):t instanceof Date?new t.constructor(e):new Date(e)}function I(t,e){return p(e||t,t)}function m(t,e,n){return p(n?.in||t,+I(t)+e)}function D(t,e,n){return m(t,e*1e3,n)}function f(t){return t*S}addEventListener("message",({data:t})=>{let e=t.stints,n=t.pits,o=t.remainingDriverChanges,d=t.pitConfig,c=t.optimizedStint,s=t.remainingTyreChange,r=E(e,n);if(r=r.sort((i,u)=>i.start.getTime()-u.start.getTime()),c){let i=b(r.at(r.length-1),o,c,d,s);r.push(...i)}r=r.sort((i,u)=>i.start.getTime()-u.start.getTime()),postMessage({timelineSteps:r})});function E(t,e){let n=[];return t.forEach(o=>{n.push(F(o))}),e.forEach(o=>{n.push(A(o))}),n}function A(t){return{durationMills:t.exitAt?t.exitAt.getTime()-t.entryAt.getTime():void 0,end:t.exitAt,pit:t,start:t.entryAt,status:t.exitAt?"DONE":"ACTIVE",stint:void 0,type:"PIT"}}function F(t){return{durationMills:t.endedAt?t.endedAt.getTime()-t.startedAt.getTime():void 0,end:t.endedAt,pit:void 0,start:t.startedAt,status:t.endedAt?"DONE":"ACTIVE",stint:t,type:"STINT"}}function b(t,e,n,o,d){let c=[],s=w(t,n,o);if(t===void 0||t.type==="PIT"){let i=m(s,n.avgStintMillisecondsTime);c.push(M(s,i,n.avgStintMillisecondsTime)),s=i}let r=Math.floor(e/2);for(let i=0;i<e;i++){let u=f(o.minPitSeconds);d>0&&i>=r-Math.floor(d/2)&&i<r+Math.ceil(d/2)&&(u=f(o.minPitWithTyreChangeSeconds),d--);let a=m(s,u);c.push(C(s,a,u));let T=m(a,n.avgStintMillisecondsTime);c.push(M(a,T,n.avgStintMillisecondsTime)),s=T}return c}function M(t,e,n){return{durationMills:n,end:e,pit:void 0,start:t,status:"FUTURE",stint:void 0,type:"STINT"}}function C(t,e,n){return{durationMills:n,end:e,pit:void 0,start:t,status:"FUTURE",stint:void 0,type:"PIT"}}function w(t,e,n){if(t===void 0)return new Date;let o;return t.type==="PIT"?o=D(t.start,n.minPitSeconds):o=m(t.start,e.avgStintMillisecondsTime),o>new Date?o:new Date}
