{
  "version": 3,
  "sources": ["src/app/lap-simulator/service/lap-simulator.service.ts"],
  "sourcesContent": ["import { inject, Injectable, signal, WritableSignal } from '@angular/core';\nimport { LapService } from \"../../lap/service/lap.service\";\nimport { ShadowLap } from \"../model/shadow-lap\";\nimport { FutureLap } from \"../model/future-lap\";\nimport { LapSimulatorConfigService } from \"./lap-simulator-config.service\";\nimport { combineLatest } from \"rxjs\";\nimport { takeUntilDestroyed, toObservable } from '@angular/core/rxjs-interop';\nimport { RacePositionService } from '../../race/service/race-position.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LapSimulatorService {\n  private readonly lapService = inject(LapService);\n  private readonly lapSimulatorConfigService = inject(LapSimulatorConfigService);\n  private readonly racePositionService = inject(RacePositionService);\n\n  readonly normalizedCumulatedTimeLaps: WritableSignal<Map<number, number[]>> = signal(new Map<number, number[]>());\n  readonly shadowLaps: WritableSignal<ShadowLap[]> = signal([]);\n  readonly futureLaps: WritableSignal<FutureLap[]> = signal([]);\n  readonly futureLapsWithPitNow: WritableSignal<FutureLap[]> = signal([]);\n  readonly virtualLastCumulatedTimeByRaceNumber: WritableSignal<Map<number, number>> = signal(new Map<number, number>());\n\n  private readonly worker: Worker | undefined;\n\n  constructor() {\n    if (typeof Worker !== 'undefined') {\n      // Create a new\n      this.worker = new Worker(new URL('./lap-simulator.worker', import.meta.url));\n      this.worker.onmessage = ({ data }) => {\n        this.normalizedCumulatedTimeLaps.set(data.normalizedCumulatedTimeLaps);\n        this.shadowLaps.set(data.shadowLaps);\n        this.futureLaps.set(data.futureLaps);\n        this.futureLapsWithPitNow.set(data.futureLapsWithPitNow);\n        this.virtualLastCumulatedTimeByRaceNumber.set(data.virtualLastCumulatedTimeByRaceNumber);\n      };\n    }\n\n    combineLatest({\n      cumulatedTimeByRaceNumber : toObservable(this.lapService.cumulatedTimeByRaceNumber),\n      pacesByRaceNumber: toObservable(this.lapService.pacesByRaceNumber),\n      lastLapNumberByRaceNumber: toObservable(this.lapService.lastLapNumberByRaceNumber),\n      lapSimulatorConfig: toObservable(this.lapSimulatorConfigService.lapSimulatorConfig),\n      firstTeamRaceNumber: toObservable(this.racePositionService.firstTeamRaceNumber)\n    })\n    .pipe(takeUntilDestroyed())\n    .subscribe((\n      {\n        cumulatedTimeByRaceNumber,\n        pacesByRaceNumber,\n        lastLapNumberByRaceNumber,\n        lapSimulatorConfig,\n        firstTeamRaceNumber\n      }) => {\n      if (this.worker && lapSimulatorConfig) {\n        this.worker.postMessage({\n          cumulatedTimeByRaceNumber: cumulatedTimeByRaceNumber,\n          pacesByRaceNumber: pacesByRaceNumber,\n          lastLapNumberByRaceNumber: lastLapNumberByRaceNumber,\n          lapSimulatorConfig: lapSimulatorConfig,\n          firstTeamRaceNumber: firstTeamRaceNumber,\n        });\n      }\n    });\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAYM,IAAO,sBAAP,MAAO,qBAAmB;EACb,aAAa,OAAO,UAAU;EAC9B,4BAA4B,OAAO,yBAAyB;EAC5D,sBAAsB,OAAO,mBAAmB;EAExD,8BAAqE,OAAO,oBAAI,IAAG,CAAoB;EACvG,aAA0C,OAAO,CAAA,CAAE;EACnD,aAA0C,OAAO,CAAA,CAAE;EACnD,uBAAoD,OAAO,CAAA,CAAE;EAC7D,uCAA4E,OAAO,oBAAI,IAAG,CAAkB;EAEpG;EAEjB,cAAA;AACE,QAAI,OAAO,WAAW,aAAa;AAEjC,WAAK,SAAS,IAAI,OAAO,IAAI,IAAG,sBAA2B,YAAY,GAAG,GAAC,EAAA,MAAA,SAAA,CAAA;AAC3E,WAAK,OAAO,YAAY,CAAC,EAAE,KAAI,MAAM;AACnC,aAAK,4BAA4B,IAAI,KAAK,2BAA2B;AACrE,aAAK,WAAW,IAAI,KAAK,UAAU;AACnC,aAAK,WAAW,IAAI,KAAK,UAAU;AACnC,aAAK,qBAAqB,IAAI,KAAK,oBAAoB;AACvD,aAAK,qCAAqC,IAAI,KAAK,oCAAoC;MACzF;IACF;AAEA,kBAAc;MACZ,2BAA4B,aAAa,KAAK,WAAW,yBAAyB;MAClF,mBAAmB,aAAa,KAAK,WAAW,iBAAiB;MACjE,2BAA2B,aAAa,KAAK,WAAW,yBAAyB;MACjF,oBAAoB,aAAa,KAAK,0BAA0B,kBAAkB;MAClF,qBAAqB,aAAa,KAAK,oBAAoB,mBAAmB;KAC/E,EACA,KAAK,mBAAkB,CAAE,EACzB,UAAU,CACT,EACE,2BACA,mBACA,2BACA,oBACA,oBAAmB,MAChB;AACL,UAAI,KAAK,UAAU,oBAAoB;AACrC,aAAK,OAAO,YAAY;UACtB;UACA;UACA;UACA;UACA;SACD;MACH;IACF,CAAC;EACH;;qCApDW,sBAAmB;EAAA;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
