import{a as N}from"./chunk-YNYP3OTC.js";import{a as u,l as b,r as z}from"./chunk-IGED4TOA.js";import{M as a,N as l,aa as f,ba as m,fa as M}from"./chunk-Q6UHPJXR.js";import{$b as C,Ca as U,Ka as O,M as y,N as d,R as p,Sb as F,Ua as w,Wb as B,X as o,ab as R,bb as A,cc as v,ob as V,qa as S,qb as j,sa as r,t as c,u as h,z as x}from"./chunk-7TD4AYMG.js";var K=class t extends u{collectionPath="/board-configs";collectionRef=m(this.firestore,this.collectionPath);boardConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.boardConfig.set(i.at(0))})}updateDriverVisibility(i){let e=this.boardConfig();e&&(e.driverVisible=i,this.updateDataWithMessage(e.id,e,"driver visibility"))}updateDriverChangeVisibility(i){let e=this.boardConfig();e&&(e.driverChangeVisible=i,this.updateDataWithMessage(e.id,e,"driver change visibility"))}updateInterphoneVisibility(i){let e=this.boardConfig();e&&(e.interphoneVisible=i,this.updateDataWithMessage(e.id,e,"interphone visibility"))}updateFuelVisibility(i){let e=this.boardConfig();e&&(e.fuelVisible=i,this.updateDataWithMessage(e.id,e,"fuel visibility"))}updateKartVisibility(i){let e=this.boardConfig();e&&(e.kartVisible=i,this.updateDataWithMessage(e.id,e,"kart visibility"))}updateLapMissingVisibility(i){let e=this.boardConfig();e&&(e.lapMissingVisible=i,this.updateDataWithMessage(e.id,e,"lap missing visibility"))}updatePitLaneVisibility(i){let e=this.boardConfig();e&&(e.pitLaneVisible=i,this.updateDataWithMessage(e.id,e,"pit lane visibility"))}updateActiveStintVisibility(i){let e=this.boardConfig();e&&(e.activeStintVisible=i,this.updateDataWithMessage(e.id,e,"active stint visibility"))}updateStintOptimizerVisibility(i){let e=this.boardConfig();e&&(e.stintOptimizerVisible=i,this.updateDataWithMessage(e.id,e,"stint optimizer visibility"))}updateDeltaStintVisibility(i){let e=this.boardConfig();e&&(e.deltaStintVisible=i,this.updateDataWithMessage(e.id,e,"delta stint visibility"))}updateKartChangeVisibility(i){let e=this.boardConfig();e&&(e.kartChangeVisible=i,this.updateDataWithMessage(e.id,e,"kart change visibility"))}updateTyreChangeVisibility(i){let e=this.boardConfig();e&&(e.tyreChangeVisible=i,this.updateDataWithMessage(e.id,e,"tyre change visibility"))}updateDriverPerformanceVisibility(i){let e=this.boardConfig();e&&(e.driverPerformanceVisible=i,this.updateDataWithMessage(e.id,e,"driver performance visibility"))}updateStintVisibility(i){let e=this.boardConfig();e&&(e.stintVisible=i,this.updateDataWithMessage(e.id,e,"stint visibility"))}updatePitVisibility(i){let e=this.boardConfig();e&&(e.pitVisible=i,this.updateDataWithMessage(e.id,e,"pit visibility"))}updateLiveTimingVisibility(i){let e=this.boardConfig();e&&(e.liveTimingVisible=i,this.updateDataWithMessage(e.id,e,"live timing visibility"))}updateSteeringWheelMessageButtonVisibility(i){let e=this.boardConfig();e&&(e.steeringWheelMessageButtonVisible=i,this.updateDataWithMessage(e.id,e,"steering wheel message button visibility"))}updateTyrePressureVisibility(i){let e=this.boardConfig();e&&(e.tyrePressureVisible=i,this.updateDataWithMessage(e.id,e,"tyre pressure visibility"))}updateTimelineVisibility(i){let e=this.boardConfig();e&&(e.timelineVisible=i,this.updateDataWithMessage(e.id,e,"timeline visibility"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var $=class t extends u{collectionPath="/live-timing-configs";collectionRef=m(this.firestore,this.collectionPath);liveTimingConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.liveTimingConfig.set(i.at(0))})}updateUrl(i){let e=this.liveTimingConfig();e&&(e.url=i,this.updateDataWithMessage(e.id,e,"live timing url"))}updateSource(i){let e=this.liveTimingConfig();e&&(e.source=i,this.updateDataWithMessage(e.id,e,"live timing source"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var H=class t{text=S.required();backgroundColor=S("bg-blue-500");textColor=S("text-neutral-100");bounceCondition=S(!1);large=S(!1);constructor(){}getClasses(){return{"text-xl p-2":this.large(),"px-2 py-1":!this.large(),"animate-bounce":this.bounceCondition(),[this.backgroundColor()]:!0,[this.textColor()]:!0}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=O({type:t,selectors:[["app-chip"]],inputs:{text:[1,"text"],backgroundColor:[1,"backgroundColor"],textColor:[1,"textColor"],bounceCondition:[1,"bounceCondition"],large:[1,"large"]},decls:2,vars:2,consts:[[1,"rounded-lg","text-center",3,"ngClass"]],template:function(e,s){e&1&&(R(0,"div",0),V(1),A()),e&2&&(w("ngClass",s.getClasses()),U(),j(" ",s.text(),`
`))},dependencies:[B,F],encapsulation:2})};function ie(t){return{id:t.id,raceId:t.raceId,driverId:t.driverId,startedAt:new Date(t.startedAt),endedAt:t.endedAt!=null?new Date(t.endedAt):void 0,optimizedMilliseconds:t.optimizedMilliseconds,frontLeftTyrePressurePsi:t.frontLeftTyrePressurePsi,frontRightTyrePressurePsi:t.frontRightTyrePressurePsi,rearLeftTyrePressurePsi:t.rearLeftTyrePressurePsi,rearRightTyrePressurePsi:t.rearRightTyrePressurePsi}}function E(t){return t.map(i=>ie(i))}var P=class t extends u{collectionPath="stint-updates";collectionRef=m(this.firestore,this.collectionPath);raceService=o(b);stintUpdate=r(void 0);constructor(){super(),this.getStintUpdate().pipe(a()).subscribe(i=>{if(i){let e=this.stintUpdate();(!e||e.updatedAt<i.updatedAt)&&this.stintUpdate.set(i)}})}getStintUpdate(){return h({stintUpdates:f(this.collectionRef),activeRace:l(this.raceService.activeRace)}).pipe(d(this.destroyed),c(({stintUpdates:i,activeRace:e})=>{let s=i;if(e&&s.length>0)return s.filter(n=>!n.deleted&&n.raceId===e.id).at(0)}))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var W=class t{path="/stint-management";httpClient=o(C);stintUpdateService=o(P);raceService=o(b);notificationService=o(M);stints=r([]);constructor(){l(this.raceService.activeRace).pipe(y(i=>i?this.getStints(i.id,[]):[]),a()).subscribe(i=>{this.stints.set(this.merge(this.stints(),i))}),l(this.stintUpdateService.stintUpdate).pipe(y(i=>i?this.getStints(i.raceId,i.updatedIds):[]),a()).subscribe(i=>{this.stints.set(this.merge(this.stints(),i))})}refreshStints(){let i=this.raceService.activeRace();if(i===void 0){this.notificationService.error("No active race");return}this.getStints(i.id,[]).subscribe(e=>{this.stints.set(e),this.notificationService.success("Stints refreshed")})}merge(i,e){let s=new Map(i.map(n=>[n.id,n]));return e.forEach(n=>{s.set(n.id,n)}),Array.from(s.values()).sort((n,D)=>D.id-n.id)}getStints(i,e){return this.httpClient.post(`${v.baseUrl}${this.path}/stints`,{raceId:i,ids:e}).pipe(c(s=>E(s)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};function te(t){return{id:t.id,name:t.name,surname:t.surname,raceName:t.raceName}}function q(t){return t.map(i=>te(i))}var Q=class t{path="/driver-management";httpClient=o(C);stintDataService=o(W);driverConfigService=o(N);lapService=o(z);notificationService=o(M);worker;drivers=r([]);driversTimeOnTrackMap=r(new Map);driversTimeOnTrackWarningMap=r(new Map);driversStintCountMap=r(new Map);driverWithMoreTimeFromLastStint=r(void 0);driversTimeFromLastStintMap=r(new Map);raceNameById=r(new Map);driverPaceById=r(new Map);driverBestLapById=r(new Map);driverIdBestPace=r(void 0);driverBestPaceMillisecond=r(void 0);driverLastStintIdByDriverId=r(new Map);driversTimeOnTrackWarningCount=r(0);constructor(){this.getAll().pipe(a()).subscribe(i=>{this.drivers.set(i)}),typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-6OMVFSWU.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:i})=>{this.driversTimeOnTrackMap.set(i.driversTimeOnTrackMap),this.driversTimeOnTrackWarningMap.set(i.driversTimeOnTrackWarningMap),this.driversStintCountMap.set(i.driversStintCountMap),this.driverWithMoreTimeFromLastStint.set(i.driversStintCountMap),this.driversTimeFromLastStintMap.set(i.driversTimeFromLastStintMap),this.raceNameById.set(i.raceNameById),this.driverPaceById.set(i.driverPaceById),this.driverBestLapById.set(i.driverBestLapById),this.driverIdBestPace.set(i.driverIdBestPace),this.driverBestPaceMillisecond.set(i.driverBestPaceMillisecond),this.driversTimeOnTrackWarningCount.set(i.driversTimeOnTrackWarningCount),this.driverLastStintIdByDriverId.set(i.driverLastStintIdByDriverId)}),h({drivers:l(this.drivers),stints:l(this.stintDataService.stints),driverConfig:l(this.driverConfigService.driverConfig),validTeamPaceLaps:l(this.lapService.validTeamPaceLaps),ping:x(1e3)}).pipe(a()).subscribe(({drivers:i,stints:e,driverConfig:s,validTeamPaceLaps:n})=>{this.worker&&s&&this.worker.postMessage({drivers:i,stints:e,driverConfig:s,validTeamPaceLaps:n})})}refreshDrivers(){this.getAll().subscribe(i=>{this.drivers.set(i),this.notificationService.success("Drivers refreshed")})}getAll(){return this.httpClient.get(`${v.baseUrl}${this.path}/drivers`).pipe(c(i=>q(i)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var Z=class t extends u{collectionPath="/kart-configs";collectionRef=m(this.firestore,this.collectionPath);kartConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.kartConfig.set(i.at(0))})}updateMaxKartMinute(i){let e=this.kartConfig();e&&(e.maxKartMinute=i,this.updateDataWithMessage(e.id,e,"max kart minute"))}updateMinKartChange(i){let e=this.kartConfig();e&&(e.minKartChange=i,this.updateDataWithMessage(e.id,e,"min kart change"))}updateMaxKartChange(i){let e=this.kartConfig();e&&(e.maxKartChange=i,this.updateDataWithMessage(e.id,e,"max kart change"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var G=class t extends u{collectionPath="/pit-lane-configs";collectionRef=m(this.firestore,this.collectionPath);pitLaneConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.pitLaneConfig.set(i.at(0))})}updateDriverId(i){let e=this.pitLaneConfig();e&&(e.driverId=i,this.updateDataWithMessage(e.id,e,"next pit driver id"))}updateRefuel(i){let e=this.pitLaneConfig();e&&(e.refuel=i,this.updateDataWithMessage(e.id,e,"next pit refuel"))}updateTyreChange(i){let e=this.pitLaneConfig();e&&(e.tyreChange=i,this.updateDataWithMessage(e.id,e,"next pit tyre change"))}updateInterphoneChange(i){let e=this.pitLaneConfig();e&&(e.interphoneChange=i,this.updateDataWithMessage(e.id,e,"next pit interphone change"))}updateKartChange(i){let e=this.pitLaneConfig();e&&(e.kartChange=i,this.updateDataWithMessage(e.id,e,"next pit kart change"))}updateCloseBeforeEndRaceMinute(i){let e=this.pitLaneConfig();e&&(e.closeBeforeEndRaceMinute=i,this.updateDataWithMessage(e.id,e,"close before end race minute"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var J=class t extends u{collectionPath="/tyre-configs";collectionRef=m(this.firestore,this.collectionPath);tyreConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.tyreConfig.set(i.at(0))})}updateStartTyreChangeWindowHour(i){let e=this.tyreConfig();e&&(e.startTyreChangeWindowHour=i,this.updateDataWithMessage(e.id,e,"start tyre change window hour"))}updateEndTyreChangeWindowHour(i){let e=this.tyreConfig();e&&(e.endTyreChangeWindowHour=i,this.updateDataWithMessage(e.id,e,"end tyre change window hour"))}updateMinTyreChange(i){let e=this.tyreConfig();e&&(e.minTyreChange=i,this.updateDataWithMessage(e.id,e,"min tyre change"))}updateMinTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.minTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"min tyre pressure psi"))}updateMaxTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.maxTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"max tyre pressure psi"))}updateFrontLeftTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.frontLeftTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"front left tyre pressure psi"))}updateFrontRightTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.frontRightTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"front right tyre pressure psi"))}updateRearLeftTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.rearLeftTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"rear left tyre pressure psi"))}updateRearRightTyrePressurePsi(i){let e=this.tyreConfig();e&&(e.rearRightTyrePressurePsi=i,this.updateDataWithMessage(e.id,e,"rear right tyre pressure psi"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};function re(t){return{id:t.id,raceId:t.raceId,entryAt:new Date(t.entryAt),exitAt:t.exitAt!=null?new Date(t.exitAt):void 0,entryDriverId:t.entryDriverId,exitDriverId:t.exitDriverId,refuel:t.refuel,tyreChange:t.tyreChange,interphoneChange:t.interphoneChange,kartChange:t.kartChange}}function X(t){return t.map(i=>re(i))}var I=class t extends u{collectionPath="/pit-updates";collectionRef=m(this.firestore,this.collectionPath);raceService=o(b);pitUpdate=r(void 0);constructor(){super(),this.getPitUpdate().pipe(a()).subscribe(i=>{if(i){let e=this.pitUpdate();(!e||e.updatedAt<i.updatedAt)&&this.pitUpdate.set(i)}})}getPitUpdate(){return h({pitUpdates:f(this.collectionRef),activeRace:l(this.raceService.activeRace)}).pipe(d(this.destroyed),c(({pitUpdates:i,activeRace:e})=>{let s=i;if(e&&s.length>0)return s.filter(n=>!n.deleted&&n.raceId===e.id).at(0)}))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var Y=class t{path="/pit-management";httpClient=o(C);pitUpdateService=o(I);raceService=o(b);notificationService=o(M);pits=r([]);constructor(){l(this.raceService.activeRace).pipe(y(i=>i?this.getPits(i.id,[]):[]),a()).subscribe(i=>{this.pits.set(this.merge(this.pits(),i))}),l(this.pitUpdateService.pitUpdate).pipe(y(i=>i?this.getPits(i.raceId,i.updatedIds):[]),a()).subscribe(i=>{this.pits.set(this.merge(this.pits(),i))})}refreshPits(){let i=this.raceService.activeRace();if(i===void 0){this.notificationService.info("No active race");return}this.getPits(i.id,[]).subscribe(e=>{this.pits.set(e),this.notificationService.success("Pits refreshed")})}merge(i,e){let s=new Map(i.map(n=>[n.id,n]));return e.forEach(n=>{s.set(n.id,n)}),Array.from(s.values()).sort((n,D)=>D.id-n.id)}getPits(i,e){return this.httpClient.post(`${v.baseUrl}${this.path}/pits`,{raceId:i,ids:e}).pipe(c(s=>X(s)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};function ne(t){return{id:t.id,raceId:t.raceId,raceNumber:t.raceNumber,lapNumber:t.lapNumber}}function T(t){return t.map(i=>ne(i))}var k=class t extends u{collectionPath="/lap-missing-updates";collectionRef=m(this.firestore,this.collectionPath);raceService=o(b);lapMissingUpdate=r(void 0);constructor(){super(),h({missingLapUpdate:this.getMissingLapUpdate()}).pipe(a()).subscribe(({missingLapUpdate:i})=>{if(i){let e=this.lapMissingUpdate();(!e||e.updatedAt<i.updatedAt)&&this.lapMissingUpdate.set(i)}})}getMissingLapUpdate(){return h({updates:f(this.collectionRef),activeRace:l(this.raceService.activeRace)}).pipe(d(this.destroyed),c(({updates:i,activeRace:e})=>{let s=i;if(e&&s.length>0)return s.filter(n=>!n.deleted&&n.raceId===e.id).at(0)}))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var L=class t{path="/lap-missing-management";httpClient=o(C);lapMissingUpdateService=o(k);raceService=o(b);notificationService=o(M);lapMissing=r([]);constructor(){h({activeRace:l(this.raceService.activeRace)}).pipe(a(),y(({activeRace:i})=>i?this.getLapMissing(i.id,[]):[])).subscribe(i=>{this.lapMissing.set(this.mergeLapMissing(this.lapMissing(),i))}),l(this.lapMissingUpdateService.lapMissingUpdate).pipe(a(),y(i=>i?i.updatedIds.length>0?this.getLapMissing(i.raceId,i.updatedIds).pipe(c(e=>({fetchedLapMissing:e,deletedIds:i.deletedIds}))):[{fetchedLapMissing:[],deletedIds:i.deletedIds}]:[])).subscribe(i=>{let e=this.lapMissing();i.deletedIds.length>0&&(e=e.filter(n=>!i.deletedIds.includes(n.id)));let s=this.mergeLapMissing(e,i.fetchedLapMissing);this.lapMissing.set(s)})}refreshLapMissing(){let i=this.raceService.activeRace();if(i===void 0){this.notificationService.info("No active race");return}this.getLapMissing(i.id,[]).subscribe(e=>{this.lapMissing.set(e),this.notificationService.success("Lap missing refreshed")})}testCloudTaskQueue(){this.httpClient.get(`${v.baseUrl}${this.path}/test-cloud-task-queue`).subscribe(i=>{this.notificationService.success("Cloud task queue test successful")})}forceCheckLapMissing(){this.sendForceCheckLapMissing().subscribe(()=>{this.notificationService.success("Check lap missing forced")})}mergeLapMissing(i,e){let s=new Map(i.map(n=>[n.id,n]));return e.forEach(n=>{s.set(n.id,n)}),Array.from(s.values()).sort((n,D)=>n.id-D.id)}getLapMissing(i,e){return this.httpClient.post(`${v.baseUrl}${this.path}/lap-missing`,{raceId:i,ids:e}).pipe(c(s=>T(s)))}sendForceCheckLapMissing(){return this.httpClient.get(`${v.baseUrl}${this.path}/force-check-lap-missing`).pipe(c(i=>T(i)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var _=class t{lapMissingDataService=o(L);worker;lapMissingByRaceNumber=r(new Map);lapMissingCount=r(0);constructor(){typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-D4ZULUCF.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:i})=>{this.lapMissingByRaceNumber.set(i.lapMissingByRaceNumber),this.lapMissingCount.set(i.lapMissingCount)}),h({lapMissing:l(this.lapMissingDataService.lapMissing)}).pipe(a()).subscribe(({lapMissing:i})=>{this.worker&&this.worker.postMessage({lapMissing:i})})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};var ee=class t extends u{collectionPath="/timeline-config";collectionRef=m(this.firestore,this.collectionPath);timelineConfig=r(void 0);constructor(){super(),this.getAll().pipe(a()).subscribe(i=>{i.length>0&&this.timelineConfig.set(i.at(0))})}updateVisibleAfterMinWidthPixel(i){let e=this.timelineConfig();e&&(e.visibleAfterMinWidthPixel=i,this.updateDataWithMessage(e.id,e,"visible with min width pixel"))}getAll(){return f(this.collectionRef).pipe(d(this.destroyed),c(i=>i.map(e=>e).filter(e=>!e.deleted)))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"})};export{$ as a,K as b,H as c,W as d,Q as e,Z as f,G as g,J as h,Y as i,L as j,_ as k,ee as l};
