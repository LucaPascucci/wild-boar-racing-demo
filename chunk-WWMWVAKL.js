import{a as J,b as q}from"./chunk-YNYP3OTC.js";import{a as B}from"./chunk-2QPBAZ2R.js";import{a as h}from"./chunk-Y44SY3C2.js";import{a as X}from"./chunk-N2W6DWYQ.js";import{a as $}from"./chunk-JYL5VZXP.js";import{a as H}from"./chunk-PINGEYOB.js";import{b as z}from"./chunk-AGTGVVTX.js";import{g as E,h as I,k as Q}from"./chunk-QB5SOPTM.js";import{p as K,q as Z,r as C}from"./chunk-IGED4TOA.js";import{M as R,N as u}from"./chunk-Q6UHPJXR.js";import{Ca as o,Jb as w,Ka as G,Oa as b,R as x,Sb as V,Tb as U,Ua as p,X as m,Ya as f,ab as l,bb as a,cb as A,gb as P,hb as v,ob as n,qb as c,sa as d,u as y,vb as N,wb as O}from"./chunk-7TD4AYMG.js";import"./chunk-2VMXMS7J.js";var k=class r{lapService=m(C);pitConfig=m(q);driverConfigService=m(J);lapSimulatorConfigService=m(h);worker;pitDoneByRaceNumber=d(new Map);remainingPitByRaceNumber=d(new Map);remainingPitTimeMillisecondsByRaceNumber=d(new Map);constructor(){typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-PJIPF4GL.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:t})=>{this.pitDoneByRaceNumber.set(t.pitDoneByRaceNumber),this.remainingPitByRaceNumber.set(t.remainingPitByRaceNumber),this.remainingPitTimeMillisecondsByRaceNumber.set(t.remainingPitTimeMillisecondsByRaceNumber)}),y({pitLaps:u(this.lapService.pitLaps),pacesByRaceNumber:u(this.lapService.pacesByRaceNumber),pitConfig:u(this.pitConfig.pitConfig),driverConfig:u(this.driverConfigService.driverConfig),lapSimulatorConfig:u(this.lapSimulatorConfigService.lapSimulatorConfig)}).pipe(R()).subscribe(({pitLaps:t,pacesByRaceNumber:i,pitConfig:e,driverConfig:s,lapSimulatorConfig:S})=>{this.worker&&e&&s&&S&&this.worker.postMessage({pitLaps:t,pacesByRaceNumber:i,pitConfig:e,driverConfig:s,lapSimulatorConfig:S})})}static \u0275fac=function(i){return new(i||r)};static \u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"})};var _=class r{lapSimulatorService=m(B);pitSimulatorService=m(k);worker;virtualRacePositionByRaceNumber=d(new Map);constructor(){typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-UMXAK7JI.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:t})=>{this.virtualRacePositionByRaceNumber.set(t.virtualRacePositionByRaceNumber)}),y({virtualLastCumulatedTimeByRaceNumber:u(this.lapSimulatorService.virtualLastCumulatedTimeByRaceNumber),remainingPitTimeMillisecondsByRaceNumber:u(this.pitSimulatorService.remainingPitTimeMillisecondsByRaceNumber)}).pipe(R()).subscribe(({virtualLastCumulatedTimeByRaceNumber:t,remainingPitTimeMillisecondsByRaceNumber:i})=>{this.worker&&this.worker.postMessage({virtualLastCumulatedTimeByRaceNumber:t,remainingPitTimeMillisecondsByRaceNumber:i})})}static \u0275fac=function(i){return new(i||r)};static \u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"})};var T=class r{lapSimulatorConfigService=m(h);lapSimulatorService=m(B);worker;virtualGapByRaceNumber=d(new Map);constructor(){typeof Worker<"u"&&(this.worker=new Worker(new URL("worker-ZKFM44ZG.js",import.meta.url),{type:"module"}),this.worker.onmessage=({data:t})=>{this.virtualGapByRaceNumber.set(t.virtualGapByRaceNumber)}),y({lapSimulatorConfig:u(this.lapSimulatorConfigService.lapSimulatorConfig),virtualLastCumulatedTimeByRaceNumber:u(this.lapSimulatorService.virtualLastCumulatedTimeByRaceNumber)}).pipe(R()).subscribe(({lapSimulatorConfig:t,virtualLastCumulatedTimeByRaceNumber:i})=>{this.worker&&t&&this.worker.postMessage({lapSimulatorConfig:t,virtualLastCumulatedTimeByRaceNumber:i})})}static \u0275fac=function(i){return new(i||r)};static \u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"})};var W=r=>({"cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700":!0,"bg-neutral-200 dark:bg-neutral-600":r}),ie=(r,t)=>({"bg-green-100 dark:bg-green-900 font-semibold":r,"hover:bg-neutral-100 dark:hover:bg-neutral-700":t});function re(r,t){r&1&&(l(0,"th",11),n(1," Category "),a())}function oe(r,t){if(r&1&&(l(0,"th",13),n(1," Virtual gap "),a()),r&2){let i=v();p("tooltipEnabled",!0)("tooltipData",i.tooltipPredictedData)("tooltipPosition",i.tooltipPosition)}}function ne(r,t){r&1&&n(0," RP ")}function ae(r,t){r&1&&n(0," Remaining pit ")}function le(r,t){if(r&1&&(l(0,"th",13),n(1," Remaining pit time "),a()),r&2){let i=v();p("tooltipEnabled",!0)("tooltipData",i.tooltipPredictedData)("tooltipPosition",i.tooltipPosition)}}function me(r,t){r&1&&n(0," VP ")}function ce(r,t){r&1&&n(0," Virtual position ")}function se(r,t){if(r&1&&(l(0,"td",21),n(1),a()),r&2){let i=v().$implicit;o(),c(" ",i.category," ")}}function pe(r,t){if(r&1&&(l(0,"td",22),n(1),a()),r&2){let i=v().$implicit,e=v();o(),c(" ",e.getVirtualGap(i.raceNumber)," ")}}function ue(r,t){if(r&1&&(l(0,"td",22),n(1),a()),r&2){let i=v().$implicit,e=v();o(),c(" ",e.getRemainingPitTimeString(i.raceNumber)," ")}}function de(r,t){if(r&1&&(l(0,"tr",17)(1,"td",18),n(2),a(),l(3,"td",19),n(4),a(),l(5,"td",20),n(6),a(),b(7,se,2,1,"td",21),l(8,"td",19),n(9),a(),b(10,pe,2,1,"td",22),l(11,"td",19),n(12),a(),l(13,"td",19),n(14),a(),b(15,ue,2,1,"td",22),l(16,"td",19),n(17),a()()),r&2){let i=t.$implicit,e=v();p("ngClass",O(11,ie,i.id===e.activeTeamId(),i.id!==e.activeTeamId())),o(2),c(" ",e.getRacePosition(i.raceNumber)," "),o(2),c(" ",i.raceNumber," "),o(2),c(" ",i.name," "),o(),f(e.smallScreen?-1:7),o(2),c(" ",e.getLastLapNumber(i.raceNumber)," "),o(),f(e.smallScreen?-1:10),o(2),c(" ",e.getPitDone(i.raceNumber)," "),o(2),c(" ",e.getRemainingPit(i.raceNumber)," "),o(),f(e.smallScreen?-1:15),o(2),c(" ",e.getVirtualPosition(i.raceNumber)," ")}}var Y=class r{titleService=m(z);teamDataService=m(K);teamService=m(Z);racePositionService=m(Q);pitSimulatorService=m(k);raceSimulatorService=m(_);lapService=m(C);gapSimulatorService=m(T);sortState=d({column:"position",direction:"asc"});teams=w(()=>{let t=this.teamDataService.teams(),i=this.racePositionService.racePositionByRaceNumber(),e=this.sortState();return t.slice().sort((s,S)=>{let g=0;switch(e.column){case"position":let D=i.get(s.raceNumber),L=i.get(S.raceNumber);D===void 0&&L===void 0?g=s.raceNumber-S.raceNumber:D===void 0?g=1:L===void 0?g=-1:g=D-L;break;case"raceNumber":g=s.raceNumber-S.raceNumber;break;case"finalPosition":let F=this.getVirtualPosition(s.raceNumber),j=this.getVirtualPosition(S.raceNumber),ee=typeof F=="number"?F:Number.MAX_SAFE_INTEGER,te=typeof j=="number"?j:Number.MAX_SAFE_INTEGER;g=ee-te;break}return e.direction==="asc"?g:-g})});activeTeamId=w(()=>this.teamService.activeTeam()?.id);tooltipPositionData={footer:"",paragraphs:["Position"],title:""};tooltipRaceNumberData={footer:"",paragraphs:["Race Number"],title:""};tooltipCalculatedData={footer:"",paragraphs:["Calculated from extracted laps"],title:""};tooltipPredictedData={footer:"",paragraphs:["Predicted"],title:""};tooltipPosition="above";smallScreen=!1;constructor(){this.titleService.setTitle("WBR - Live ranking"),this.onResize(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){this.smallScreen=850>window.innerWidth}getRacePosition(t){return this.racePositionService.racePositionByRaceNumber().get(t)??""}getLastLapNumber(t){return this.lapService.lastLapNumberByRaceNumber().get(t)??0}getVirtualGap(t){let e=this.gapSimulatorService.virtualGapByRaceNumber().get(t);if(e){let s=e>0?"+ ":"- ";return e=Math.abs(e),e>=36e5?s+E(e):s+I(e)}return"--:--.---"}getPitDone(t){return this.pitSimulatorService.pitDoneByRaceNumber().get(t)??0}getRemainingPit(t){return this.pitSimulatorService.remainingPitByRaceNumber().get(t)??0}getRemainingPitTimeString(t){let e=this.pitSimulatorService.remainingPitTimeMillisecondsByRaceNumber().get(t);if(e)if(e>=36e5)E(e);else return I(e);return"--:--.---"}getVirtualPosition(t){return this.raceSimulatorService.virtualRacePositionByRaceNumber().get(t)||0}sortBy(t){let i=this.sortState();i.column===t?this.sortState.set({column:t,direction:i.direction==="asc"?"desc":"asc"}):this.sortState.set({column:t,direction:"asc"})}getSortIcon(t){let i=this.sortState();return i.column!==t?"\u2195\uFE0F":i.direction==="asc"?"\u2B06\uFE0F":"\u2B07\uFE0F"}isSortedBy(t){return this.sortState().column===t}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=G({type:r,selectors:[["app-live-ranking"]],decls:35,vars:38,consts:[[1,"p-4","flex","flex-row","justify-between"],[1,"text-xl","md:text-3xl","dark:text-neutral-100","text-neutral-900","font-semibold"],[1,"mx-2","grid","grid-cols-1","gap-2"],[1,"flex","flex-col","md:h-fit","gap-2"],["title","\u{1F4FA} Live ranking",3,"initiallyOpen","canOpen"],["slot","body-content",1,"max-h-[900px]","flex","flex-col","overflow-clip"],[1,"w-full","bg-neutral-50","dark:bg-neutral-800","table-fixed"],[1,"sticky","top-0"],["tooltip","",1,"max-w-8","py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400","select-none",3,"click","ngClass","tooltipEnabled","tooltipData","tooltipPosition"],["tooltip","",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400","select-none",3,"click","ngClass","tooltipEnabled","tooltipData","tooltipPosition"],["colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400"],["tooltip","",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400",3,"tooltipEnabled","tooltipData","tooltipPosition"],["tooltip","","colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-right","text-xs","md:text-base","font-medium","text-neutral-700","dark:text-neutral-400",3,"tooltipEnabled","tooltipData","tooltipPosition"],[1,"flex-1","overflow-y-auto"],[1,"w-full","table-fixed"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100","font-mono"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-center","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100","font-mono"],["colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100"],[1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-left","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100"],["colspan","2",1,"py-2","border-b","border-neutral-200","dark:border-neutral-400","text-right","text-xs","md:text-base","text-neutral-900","dark:text-neutral-100","font-mono"]],template:function(i,e){i&1&&(l(0,"div",0)(1,"div",1),n(2,"\u{1F4FA} WBR - Live ranking \u{1F417}"),a(),A(3,"app-navigator"),a(),l(4,"div",2)(5,"div",3)(6,"app-card",4)(7,"div",5)(8,"table",6)(9,"thead",7)(10,"tr")(11,"th",8),P("click",function(){return e.sortBy("position")}),n(12),a(),l(13,"th",9),P("click",function(){return e.sortBy("raceNumber")}),n(14),a(),l(15,"th",10),n(16," Name "),a(),b(17,re,2,0,"th",11),l(18,"th",12),n(19," Lap "),a(),b(20,oe,2,3,"th",13),l(21,"th",12),n(22," Pit "),a(),l(23,"th",12),b(24,ne,1,0)(25,ae,1,0),a(),b(26,le,2,3,"th",13),l(27,"th",9),P("click",function(){return e.sortBy("finalPosition")}),b(28,me,1,0)(29,ce,1,0),n(30),a()()()(),l(31,"div",14)(32,"table",15)(33,"tbody"),b(34,de,18,14,"tr",16),a()()()()()()()),i&2&&(o(6),p("initiallyOpen",!0)("canOpen",!1),o(5),p("ngClass",N(32,W,e.isSortedBy("position")))("tooltipEnabled",!0)("tooltipData",e.tooltipPositionData)("tooltipPosition",e.tooltipPosition),o(),c(" P ",e.getSortIcon("position")," "),o(),p("ngClass",N(34,W,e.isSortedBy("raceNumber")))("tooltipEnabled",!0)("tooltipData",e.tooltipRaceNumberData)("tooltipPosition",e.tooltipPosition),o(),c(" RN ",e.getSortIcon("raceNumber")," "),o(3),f(e.smallScreen?-1:17),o(),p("tooltipEnabled",!0)("tooltipData",e.tooltipCalculatedData)("tooltipPosition",e.tooltipPosition),o(2),f(e.smallScreen?-1:20),o(),p("tooltipEnabled",!0)("tooltipData",e.tooltipCalculatedData)("tooltipPosition",e.tooltipPosition),o(2),p("tooltipEnabled",!0)("tooltipData",e.tooltipPredictedData)("tooltipPosition",e.tooltipPosition),o(),f(e.smallScreen?24:25),o(2),f(e.smallScreen?-1:26),o(),p("ngClass",N(36,W,e.isSortedBy("finalPosition")))("tooltipEnabled",!0)("tooltipData",e.tooltipPredictedData)("tooltipPosition",e.tooltipPosition),o(),f(e.smallScreen?28:29),o(2),c(" ",e.getSortIcon("finalPosition")," "),o(4),p("ngForOf",e.teams()))},dependencies:[H,$,U,X,V],encapsulation:2})};export{Y as LiveRankingComponent};
