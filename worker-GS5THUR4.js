addEventListener("message",({data:t})=>{let e=t.stints,n=t.optimizedStint,i=t.lapConfig,a=t.validTeamPaceLaps,s=i.referenceLapTimeMillisecond,r=M(e),c=g(r),l=b(c,s),o=v(c,n),u=T(l,n),d=L(c,n),m=A(l,n),p=O(e),f=B(a),S=I(a);postMessage({activeStint:r,activeStintTimeOnTrack:c,activeStintLaps:l,activeStintRemainingTimeOnTrack:o,activeStintRemainingLaps:u,activeStintGainedTimeOnTrack:d,activeStintGainedLaps:m,stintAVGMilliseconds:p,stintPaceById:f,stintBestLapById:S})});function M(t){for(let e of t)if(!e.endedAt)return e}function g(t){return t?new Date().getTime()-t.startedAt.getTime():0}function b(t,e){return t>=0?Math.floor(t/e):0}function v(t,e){return t>=0&&e?e.avgStintMillisecondsTime-t:0}function T(t,e){let n=0;return t>=0&&e&&(n=e.laps-t),n>0?n:0}function L(t,e){let n=0;return t>=0&&e&&(n=e.avgStintMillisecondsTime-t),n<0?Math.abs(n):0}function A(t,e){let n=0;return t>=0&&e&&(n=e.laps-t),n<0?Math.abs(n):0}function O(t){let e=t.filter(i=>i.endedAt);if(e.length===0)return 0;let n=e.reduce((i,a)=>i+(a.endedAt.getTime()-a.startedAt.getTime()),0);return Math.round(n/e.length)}function B(t){let e=new Map,n=new Map;for(let i of t){let a=n.get(i.stintId);a?(a.totalMilliseconds+=i.lapMilliseconds,a.lapCount++):n.set(i.stintId,{totalMilliseconds:i.lapMilliseconds,lapCount:1})}for(let[i,a]of n)if(a.lapCount>0&&a.totalMilliseconds>0){let s=Math.round(a.totalMilliseconds/a.lapCount);!isNaN(s)&&s>0&&e.set(i,s)}return e}function I(t){let e=new Map;for(let n of t){let i=e.get(n.stintId);(!i||n.lapMilliseconds<i)&&e.set(n.stintId,n.lapMilliseconds)}return e}
